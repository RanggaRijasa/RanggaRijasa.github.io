<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Rincian Pemakaian Paket • Mockup</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f7f6f2; --surface:#fff; --border:#e6ebee; --text:#11292a; --muted:#6b7c7d;
    --accent:#1a686a; --accent2:#17464a; --warn:#b45309; --danger:#b42318;
    --shadow:0 8px 24px rgba(17,24,39,.08); --r:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg)}

  .appbar{position:sticky;top:0;z-index:20;background:var(--accent2);color:#fff;padding:12px 16px;border-bottom-left-radius:14px;border-bottom-right-radius:14px;font-weight:700}
  .wrap{max-width:720px;margin:10px auto 130px;padding:0 16px}
  h1{font-size:18px;margin:12px 2px}
  .sub{color:var(--muted);font-size:13px;margin:0 2px 10px}

  /* Filter chips */
  .filter{display:flex;gap:8px;align-items:center;margin:8px 2px 14px}
  .chip{appearance:none;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:600}
  .chip.active{background:var(--accent);border-color:var(--accent);color:#fff}

  /* Package cards */
  .pkg{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);padding:12px;margin:10px 0}
  .pkg-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .pkg-title{font-weight:800}
  .badge{font-size:12px;border:1px solid var(--border);border-radius:999px;padding:3px 8px;background:#fbfbfb;color:var(--muted)}
  .bar{height:8px;border-radius:999px;background:#eef2f4;overflow:hidden}
  .bar > span{display:block;height:100%;background:linear-gradient(90deg,#1a686a,#2aa6a4)}

  .items{list-style:none;margin:10px 0 4px;padding:0;display:grid;gap:10px}
  .item{display:grid;grid-template-columns:1fr auto;align-items:center;gap:8px}
  .name{font-weight:700}
  .row{display:flex;gap:8px;align-items:center}
  .mini{font-size:12px;border:1px solid var(--border);border-radius:999px;padding:2px 8px;background:#fbfbfb;color:var(--muted)}
  .delta{font-weight:800}
  .delta.minus{color:var(--accent2)}
  .delta.zero{color:var(--muted)}
  .delta.warn{color:var(--warn)}
  .delta.danger{color:var(--danger)}

  .note{font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:center;margin-top:6px}
  .hr{border-top:1px dashed var(--border);margin:10px 0 0}

  /* Sticky summary */
  .sticky{position:fixed;left:0;right:0;bottom:0;background:var(--surface);border-top:1px solid var(--border);z-index:30}
  .inner{max-width:720px;margin:0 auto;padding:10px 16px 14px;display:grid;gap:10px}
  .sumrow{display:flex;justify-content:space-between;align-items:center}
  .sumrow .right{ text-align:right }
  .tot{font-weight:800}
  .cta{appearance:none;border:0;background:var(--accent2);color:#fff;font-weight:800;padding:14px;border-radius:12px}
  .cta:disabled{opacity:.5;cursor:not-allowed}

  /* helpers */
  .hidden{display:none}
  .warn-pill{background:#fff7ed;border:1px solid #fed7aa;color:#9a3412;border-radius:999px;padding:3px 8px;font-size:12px}
</style>
</head>
<body>
  <header class="appbar">Rincian Pemakaian Paket</header>

  <main class="wrap" id="root">
    <h1>Ringkasan pengurangan sesi</h1>
    <p class="sub">Tinjau sesi yang akan dipakai hari ini. Setelah konfirmasi, sisa paket akan diperbarui.</p>

    <div class="filter">
      <button id="onlyChanged" class="chip">Hanya yang berubah</button>
      <span class="badge" id="totalBadge">0 sesi • 0 mnt</span>
    </div>

    <!-- Paket akan dirender via JS -->
    <div id="list"></div>
  </main>

  <div class="sticky">
    <div class="inner">
      <div class="sumrow">
        <div>
          <div class="sub">Akan dipotong</div>
          <div class="tot" id="sumText">0 sesi • 0 mnt</div>
        </div>
        <div class="right" id="lowWarn" class="hidden"></div>
      </div>
      <button id="cta" class="cta" disabled>Konfirmasi Pemakaian</button>
    </div>
  </div>

<script>
/* ===== Sample data dari langkah sebelumnya =====
   total = kuota awal; used = dipakai hari ini; */
const DATA = [
  {
    pkgId: 'nmes-std',
    name: 'Paket NMES standard',
    items: [
      { name:'Motor UE1', dur:30, total:5, used:1 }, // pakai 1 dari 5
      { name:'Motor UE2', dur:30, total:5, used:0 }
    ]
  },
  {
    pkgId: 'bf-std',
    name: 'Paket Biofeedback standard',
    items: [
      { name:'Biofeedback 3', dur:30, total:5, used:1 },
      { name:'Biofeedback 4', dur:30, total:5, used:0 }
    ]
  }
];

const list = document.getElementById('list');
const onlyChangedBtn = document.getElementById('onlyChanged');
const sumText = document.getElementById('sumText');
const totalBadge = document.getElementById('totalBadge');
const cta = document.getElementById('cta');
const lowWarn = document.getElementById('lowWarn');

let onlyChanged = false;

function calcTotals(){
  let sessions = 0, minutes = 0, lowCount = 0;
  DATA.forEach(pkg=>{
    pkg.items.forEach(it=>{
      sessions += it.used;
      minutes += it.used * it.dur;
      const remaining = it.total - it.used;
      if(remaining <= 1 && it.used>0) lowCount++;
    });
  });
  return {sessions, minutes, lowCount};
}

function pkgProgress(pkg){
  const totalAll = pkg.items.reduce((s,i)=>s+i.total,0);
  const remainingAll = pkg.items.reduce((s,i)=>s+(i.total - i.used),0);
  return { totalAll, remainingAll, pct: totalAll? (remainingAll/totalAll*100) : 0 };
}

function itemRow(it){
  const remaining = it.total - it.used;
  const changed = it.used>0;
  const pillClass =
    remaining <= 0 ? 'danger' :
    remaining <= 1 ? 'warn' :
    changed ? 'minus' : 'zero';

  return `
    <li class="item ${(!changed && onlyChanged) ? 'hidden' : ''}">
      <div>
        <div class="name">${it.name}</div>
        <div class="row">
          <span class="mini">⏱ ${it.dur} mnt</span>
          <span class="mini">Kuota: ${it.total}</span>
        </div>
      </div>
      <div class="row">
        ${changed ? `<span class="delta minus">−${it.used}</span>` : `<span class="delta zero">0</span>`}
        <span class="mini">Sisa:</span>
        <span class="delta ${pillClass}">${remaining}</span>
      </div>
    </li>`;
}

function pkgCard(pkg){
  const { totalAll, remainingAll, pct } = pkgProgress(pkg);
  return `
    <section class="pkg">
      <div class="pkg-h">
        <div class="pkg-title">${pkg.name}</div>
        <span class="badge">Sisa ${remainingAll}/${totalAll}</span>
      </div>

      <div class="bar" aria-hidden="true"><span style="width:${pct}%"></span></div>

      <ul class="items">
        ${pkg.items.map(itemRow).join('')}
      </ul>

      <div class="hr"></div>
      <div class="note">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="9"/><path d="M12 8v4m0 4h.01"/>
        </svg>
        Pemakaian hari ini akan mengurangi kuota & memperbarui sisa paket.
      </div>
    </section>
  `;
}

function render(){
  list.innerHTML = DATA.map(pkgCard).join('');
  const {sessions, minutes, lowCount} = calcTotals();
  sumText.textContent = `${sessions} sesi • ${minutes} mnt`;
  totalBadge.textContent = `${sessions} sesi • ${minutes} mnt`;
  cta.disabled = sessions === 0;

  if(lowCount>0){
    lowWarn.innerHTML = `<span class="warn-pill">${lowCount} item hampir habis</span>`;
    lowWarn.classList.remove('hidden');
  }else{
    lowWarn.classList.add('hidden');
    lowWarn.innerHTML = '';
  }
}

onlyChangedBtn.addEventListener('click', ()=>{
  onlyChanged = !onlyChanged;
  onlyChangedBtn.classList.toggle('active', onlyChanged);
  render();
});

cta.addEventListener('click', ()=>{
  const payload = DATA.map(p=>({
    package: p.name,
    items: p.items.filter(i=>i.used>0).map(i=>({
      name:i.name, used:i.used, remaining:i.total - i.used
    }))
  }));
  alert('Konfirmasi pemakaian:\n' + JSON.stringify(payload, null, 2));
});

render();
</script>
</body>
</html>
